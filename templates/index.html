{% extends "base.html" %}

{% block title %}FileFlix - Media Center{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="/static/css/explorer.css">
    <link rel="stylesheet" href="/static/css/player.css">
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/components.css">
{% endblock %}

{% block content %}
    <div class="container">
        <!-- Loading Screen -->
        <div id="loading-screen" class="loading-screen hidden">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading...</div>
        </div>

        <!-- Toast Container -->
        <div id="toast-container"></div>        <!-- Breadcrumb -->
        <div id="breadcrumb-container" class="breadcrumb-container">
            <a href="/" class="breadcrumb-item home" aria-label="Home" data-path="">
                <i class="fas fa-home"></i>
                Home
            </a>
            <div class="breadcrumb-path" id="breadcrumb-path"></div>
        </div>

        <!-- Filter Tabs -->
        <div class="filter-tabs">
            <button class="filter-tab active" data-filter="all" aria-label="All Files">
                <i class="fas fa-th"></i>
                All Files
            </button>
            <button class="filter-tab" data-filter="video" aria-label="Videos">
                <i class="fas fa-video"></i>
                Videos
            </button>
            <button class="filter-tab" data-filter="image" aria-label="Images">
                <i class="fas fa-image"></i>
                Images
            </button>
            <button class="filter-tab" data-filter="audio" aria-label="Audio">
                <i class="fas fa-music"></i>
                Audio
            </button>
            <button class="filter-tab" data-filter="document" aria-label="Documents">
                <i class="fas fa-file-alt"></i>
                Documents
            </button>            <button class="filter-tab" data-filter="folder" aria-label="Folders">
                <i class="fas fa-folder"></i>
                Folders
            </button>
        </div>

        <!-- File Explorer -->
        <div id="file-explorer" class="file-explorer grid-view">
            <div class="loading-state">
                <div class="loading-spinner"></div>
                <div class="loading-text">Loading files...</div>
            </div>
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="empty-state hidden">
            <i class="fas fa-folder-open empty-state-icon"></i>
            <h2 class="empty-state-title">No Files Found</h2>
            <p class="empty-state-description">
                {% if logged_in %}
                    Select a media directory in Host Settings or upload files to get started.
                {% else %}
                    No media files are available in this directory.
                {% endif %}
            </p>
        </div>

        <!-- Pagination -->
        <div id="pagination-container" class="pagination-container hidden">
            <div class="pagination">
                <button class="pagination-btn" id="prev-page" disabled aria-label="Previous Page">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <span class="pagination-info" id="pagination-info"></span>
                <button class="pagination-btn" id="next-page" disabled aria-label="Next Page">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>

        <!-- Host Controls (Visible only to Host) -->
        {% if logged_in %}
        <div class="host-controls">
            <div id="system-status" class="system-status" title="System Status">
                <i class="fas fa-server"></i>
                <span>System Status</span>
            </div>
            <input id="directory-picker" type="file" webkitdirectory directory multiple aria-label="Select Directory" style="display: none;">
            <button id="select-directory-btn" class="btn btn-primary" aria-label="Select Directory">
                <i class="fas fa-folder"></i>
                Select Directory
            </button>
        </div>
        {% endif %}

        <!-- Video Modal -->
        <div id="video-modal" class="video-modal">
            <div class="video-modal-content">
                <div class="video-container">
                    <video id="video-player" class="video-player" playsinline></video>
                    <div id="video-loading" class="video-loading hidden">
                        <div class="video-loading-spinner"></div>
                        <div class="video-loading-text">Loading video...</div>
                    </div>
                    <div id="video-error" class="video-error hidden">
                        <i class="fas fa-exclamation-circle error-icon"></i>
                        <p class="error-message">Failed to load video. Please try again.</p>
                    </div>
                    <div id="video-controls" class="video-controls">
                        <div class="controls-top">
                            <span id="video-title" class="video-title"></span>
                            <div class="controls-top-right">
                                <button id="pip-btn" class="control-btn" title="Picture-in-Picture" aria-label="Picture-in-Picture">
                                    <i class="fas fa-window-restore"></i>
                                </button>
                                <button id="fullscreen-btn" class="control-btn" title="Fullscreen" aria-label="Fullscreen">
                                    <i class="fas fa-expand"></i>
                                </button>
                                <button id="close-btn" class="control-btn" title="Close" aria-label="Close">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="controls-center">
                            <button id="rewind-btn" class="control-btn large-btn" title="Rewind 10s" aria-label="Rewind 10 seconds">
                                <i class="fas fa-backward"></i>
                            </button>
                            <button id="play-pause-btn" class="control-btn extra-large-btn" title="Play/Pause" aria-label="Play/Pause">
                                <i class="fas fa-play"></i>
                            </button>
                            <button id="forward-btn" class="control-btn large-btn" title="Forward 10s" aria-label="Forward 10 seconds">
                                <i class="fas fa-forward"></i>
                            </button>
                        </div>
                        <div class="controls-bottom">
                            <div class="progress-container">
                                <div id="progress-bar" class="progress-bar">
                                    <div id="progress-buffer" class="progress-buffer"></div>
                                    <div id="progress-played" class="progress-played"></div>
                                    <div id="progress-thumb" class="progress-thumb"></div>
                                </div>
                                <div id="progress-preview" class="progress-preview">
                                    <img id="preview-img" src="" alt="Video preview">
                                    <span id="preview-time" class="preview-time"></span>
                                </div>
                            </div>
                            <div class="controls-row">
                                <div class="controls-left">
                                    <button id="play-pause-btn-bottom" class="control-btn" title="Play/Pause" aria-label="Play/Pause">
                                        <i class="fas fa-play"></i>
                                    </button>
                                    <div class="volume-container">
                                        <button id="volume-btn" class="control-btn" title="Mute/Unmute" aria-label="Mute/Unmute">
                                            <i class="fas fa-volume-up"></i>
                                        </button>
                                        <div class="volume-slider-container">
                                            <input type="range" id="volume-slider" class="volume-slider" min="0" max="100" value="100">
                                        </div>
                                    </div>
                                    <span id="time-display" class="time-display">
                                        <span id="current-time">00:00</span>
                                        <span class="time-separator">/</span>
                                        <span id="duration">00:00</span>
                                    </span>
                                </div>
                                <div class="controls-right">
                                    <button id="speed-btn" class="control-btn" title="Playback Speed" aria-label="Playback Speed">
                                        <i class="fas fa-tachometer-alt"></i>
                                        <span id="speed-display" class="speed-display">1x</span>
                                    </button>
                                    <button id="settings-btn" class="control-btn" title="Settings" aria-label="Settings">
                                        <i class="fas fa-cog"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="settings-menu" class="settings-menu">
                        <div class="settings-header">
                            <h3>Player Settings</h3>
                            <button id="settings-close" class="control-btn" title="Close Settings" aria-label="Close Settings">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="settings-content">
                            <div class="settings-section">
                                <h4>Audio Tracks</h4>
                                <div id="audio-tracks" class="track-list"></div>
                            </div>
                            <div class="settings-section">
                                <h4>Subtitles</h4>
                                <div id="subtitle-tracks" class="track-list"></div>
                            </div>
                            <div class="settings-section">
                                <h4>Quality</h4>
                                <div id="quality-options" class="quality-list">
                                    <label class="quality-option">
                                        <input type="radio" name="quality" value="auto" checked>
                                        <span>Auto</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="shortcuts-hint" class="shortcuts-hint">Press ? for shortcuts</div>
                </div>
            </div>
        </div>

        <!-- Preview Modal -->
        <div id="preview-modal" class="preview-modal">
            <div class="preview-modal-content">
                <button id="close-preview-btn" class="control-btn" title="Close" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
                <div id="preview-container" class="preview-container"></div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script>
        // Set the data-is-host attribute on body for JavaScript
        document.body.dataset.isHost = '{{ is_host|lower }}';
    </script>
{% endblock %}